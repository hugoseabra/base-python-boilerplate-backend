name: Boilerplate CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    types: [ opened, reopened, ready_for_review, synchronize ]
    branches: [ "main" ]

jobs:
    build:
      runs-on: ubuntu-latest
      strategy:
        max-parallel: 4
        matrix:
          python-version: ['3.10']

      steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v3
        with:
          python-version: ${{ matrix.python-version }}
#      - name: Run services
#        run: docker-compose -p $GITHUB_RUN_id up -d --build --exit-code-from api
      - name: Prepare environment variables
        run: mv .env-sample .env
      - name: Tests
        uses: ./.github/actions/docker-compose-run
        with:
          service: api
          command: python manage.py test --verbosity 3

#      - name: Check deployment
#        run: docker exec api DEBUG=false python manage.py check --deploy
#      - name: Run Tests
#        run: docker exec api coverage run python manage.py test
#      - name: Show coverage
#        run: docker exec api coverage report
